{% load customtags %}
{% block content %}
    <table class="table table-success table-hover table-striped table-bordered">
        <tr>
            <th>Sample</th>
            <th>Tissue</th>
            <th>Peak Group</th>
            <th>Formula</th>
            <th>Labeled Element</th>
            <th>Total Abundance</th>
            <th>Enrichment Fraction</th>
            <th>Enrichment Abundance</th>
            <th>Normalized Labeling</th>
            <th>Peak Group Set Filename</th>
            <th>Animal</th>
            <th>Genotype</th>
            <th>Body Weight (g)</th>
            <th>Age (weeks)</th>
            <th>Sex</th>
            <th>Diet</th>
            <th>Feeding Status</th>
            <th>Treatment</th>
            <th>Tracer Compound</th>
            <th>Tracer Infusion Rate (ul/min/g)</th>
            <th>Tracer Infusion Concentration (mM)</th>
            <th>Study</th>
        </tr>

        {% for pg in res.all %}
            {% for study in pg.msrun.sample.animal.studies.all %}
                <tr>
                    <!-- Sample -->
                    <td>
                        <div class="nobr">
                            <a href="{% url 'sample_detail' pg.msrun.sample.id %}">
                                {{ pg.msrun.sample.name }}
                            </a>
                        </div>
                    </td>

                    <!-- Tissue -->
                    <td>
                        {{ pg.msrun.sample.tissue.name }}
                    </td>

                    <!-- Peak Group -->
                    <td>
                        <a href="{% url 'peakgroup_detail' pg.id %}">
                            {{ pg.name }}
                        </a>
                    </td>

                    <!-- Formula -->
                    <td>
                        {{ pg.formula }}
                    </td>

                    <!-- Labeled Element -->
                    <td>
                        {{ pg.msrun.sample.animal.tracer_labeled_atom }}
                    </td>

                    <!-- Total Abundance -->
                    <td class="text-end">
                        <p title="{{ pg.total_abundance }}">{{ pg.total_abundance|floatformat:1 }}</p>
                    </td>

                    <!-- Enrichment Fraction -->
                    <td class="text-end">
                        <p title="{{ pg.enrichment_fraction }}">{{ pg.enrichment_fraction|floatformat:4 }}</p>
                    </td>

                    <!-- Enrichment Abundance -->
                    <td class="text-end">
                        <p title="{{ pg.enrichment_abundance }}">{{ pg.enrichment_abundance|floatformat:4 }}</p>
                    </td>

                    <!-- Normalized Labeling -->
                    <td class="text-end">
                        <p title="{{ pg.normalized_labeling }}">{{ pg.normalized_labeling|floatformat:4 }}</p>
                    </td>

                    <!-- Peak Group Set Filename -->
                    <td>
                        {{ pg.peak_group_set.filename }}
                    </td>

                    <!-- Animal -->
                    <td>
                        <a href="{% url 'animal_detail' pg.msrun.sample.animal.id %}">
                            {{ pg.msrun.sample.animal.name }}
                        </a>
                    </td>

                    <!-- Genotype -->
                    <td>
                        {{ pg.msrun.sample.animal.genotype }}
                    </td>

                    <!-- Body Weight (g) -->
                    <td>
                        {{ pg.msrun.sample.animal.body_weight }}
                    </td>

                    <!-- Age (weeks) -->
                    <td class="text-end">
                        <p title="{{ pg.msrun.sample.animal.age }} (d-hh:mm:ss)">{{ pg.msrun.sample.animal.age|durationToWeeks|decimalPlaces:2 }}</p>
                    </td>

                    <!-- Sex -->
                    <td>
                        {{ pg.msrun.sample.animal.sex }}
                    </td>

                    <!-- Diet -->
                    <td>
                        {{ pg.msrun.sample.animal.diet }}
                    </td>

                    <!-- Feeding Status -->
                    <td>
                        {{ pg.msrun.sample.animal.feeding_status }}
                    </td>

                    <!-- Treatment -->
                    <td>
                        {% if pg.msrun.sample.animal.treatment is None %}
                            None
                        {% else %}
                            {{ pg.msrun.sample.animal.treatment.name }}
                        {% endif %}
                    </td>

                    <!-- Tracer Compound -->
                    <td>
                        <a href="{% url 'compound_detail' pg.msrun.sample.animal.tracer_compound.id %}">
                            {{ pg.msrun.sample.animal.tracer_compound.name }}
                        </a>
                    </td>

                    <!-- Tracer Infusion Rate (ul/min/g) -->
                    <td class="text-end">
                        {{ pg.msrun.sample.animal.tracer_infusion_rate }}
                    </td>

                    <!-- Tracer Infusion Concentration (mM) -->
                    <td class="text-end">
                        {{ pg.msrun.sample.animal.tracer_infusion_concentration }}
                    </td>

                    <!-- Study -->
                    <td>
                        <a href="{% url 'study_detail' study.id %}">
                            {{ study.name }}
                        </a>
                    </td>
                </tr>
            {% endfor %}
        {% endfor %}
    </table>
{% endblock %}

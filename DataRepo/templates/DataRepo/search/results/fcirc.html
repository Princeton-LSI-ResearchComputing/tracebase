{% load customtags %}
{% block content %}
    <table class="table table-success table-hover table-bordered">
        <tr>
            <th>Serum Sample Color Legend</th>
        </tr>
        <tr class="tr-normal">
            <td>
                Previous serum sample
            </td>
        </tr>
        <tr class="tr-highlighted">
            <td>
                Last serum sample
            </td>
        </tr>
    </table>
    <table class="table table-success table-hover table-bordered">
        <tr>
            <th>Animal</th>
            <th>Study</th>
            <th>Treatment</th>
            <th>Tracer Compound</th>
            <th>Tracer Infusion Rate (ul/min/g)</th>
            <th>Tracer Infusion Concentration (mM)</th>
            <th>Time Collected (mins)</th>
            <th>Average Ra (nmol/min/g)</th>
            <th>Average Rd (nmol/min/g)</th>
            <th>Average Ra (nmol/min)</th>
            <th>Average Rd (nmol/min)</th>
            <th>Intact Ra (nmol/min/g)</th>
            <th>Intact Rd (nmol/min/g)</th>
            <th>Intact Ra (nmol/min)</th>
            <th>Intact Rd (nmol/min)</th>
        </tr>

        {% for pg in res.all %}
            {% for study in pg.msrun.sample.animal.studies.all %}
                <tr class="{% if pg.msrun.sample.id == pg.msrun.sample.animal.final_serum_sample_id %}tr-highlighted{% else %}tr-normal{% endif %}">
                    <!-- Animal -->
                    <td>
                        <a href="{% url 'animal_detail' pg.msrun.sample.animal.id %}">
                            {{ pg.msrun.sample.animal.name }}
                        </a>
                    </td>

                    <!-- Study -->
                    <td>
                        <a href="{% url 'study_detail' study.id %}">
                            {{ study.name }}
                        </a>
                    </td>

                    <!-- Treatment -->
                    <td>
                        {% if pg.msrun.sample.animal.treatment is None %}
                            None
                        {% else %}
                            <a href="{% url 'protocol_detail' pg.msrun.sample.animal.treatment.id %}">
                                {{ pg.msrun.sample.animal.treatment.name }}
                            </a>
                        {% endif %}
                    </td>

                    <!-- Tracer Compound -->
                    <td>
                        <a href="{% url 'compound_detail' pg.msrun.sample.animal.tracer_compound.id %}">
                            {{ pg.msrun.sample.animal.tracer_compound.name }}
                        </a>
                    </td>

                    <!-- Tracer Infusion Rate (ul/min/g) -->
                    <td class="text-end">
                        {{ pg.msrun.sample.animal.tracer_infusion_rate }}
                    </td>

                    <!-- Tracer Infusion Concentration (mM) -->
                    <td class="text-end">
                        {{ pg.msrun.sample.animal.tracer_infusion_concentration }}
                    </td>

                    <!-- Time Collected (mins) -->
                    <td class="text-end">
                        <p title="{{ pg.msrun.sample.time_collected }}">{{ pg.msrun.sample.time_collected|durationToMins|decimalPlaces:2 }}</p>
                    </td>

                    <!-- Average Ra (nmol/min/g) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_appearance_average_per_gram }}">{{ pg.rate_appearance_average_per_gram|floatformat:2 }}</p>
                    </td>

                    <!-- Average Rd (nmol/min/g) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_disappearance_average_per_gram }}">{{ pg.rate_disappearance_average_per_gram|floatformat:2 }}</p>
                    </td>

                    <!-- Average Ra (nmol/min) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_appearance_average_weight_normalized }}">{{ pg.rate_appearance_average_weight_normalized|floatformat:2 }}</p>
                    </td>

                    <!-- Average Rd (nmol/min) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_disappearance_average_weight_normalized }}">{{ pg.rate_disappearance_average_weight_normalized|floatformat:2 }}</p>
                    </td>

                    <!-- Average Ra (nmol/min/g) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_appearance_intact_per_gram }}">{{ pg.rate_appearance_intact_per_gram|floatformat:2 }}</p>
                    </td>

                    <!-- Average Rd (nmol/min/g) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_disappearance_intact_per_gram }}">{{ pg.rate_disappearance_intact_per_gram|floatformat:2 }}</p>
                    </td>

                    <!-- Average Ra (nmol/min) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_appearance_intact_weight_normalized }}">{{ pg.rate_appearance_intact_weight_normalized|floatformat:2 }}</p>
                    </td>

                    <!-- Average Rd (nmol/min) -->
                    <td class="text-end">
                        <p title="{{ pg.rate_disappearance_intact_weight_normalized }}">{{ pg.rate_disappearance_intact_weight_normalized|floatformat:2 }}</p>
                    </td>
                </tr>
            {% endfor %}
        {% endfor %}
    </table>
{% endblock %}

{% extends "base.html" %}
{% block content %}
<div>
    <h3>Peak Group Results</h3>
    {% if pgs %}
        <table class="table table-success table-hover table-striped table-bordered">
            <tr>
                <th>Compound</th>
                <th>Atom</th>
                <th>Sample</th>
                <th>Enrichment Fraction</th>
                <th>Tissue</th>
                <th>Mouse</th>
                <th>TIC</th>
                <th>NormFraction</th>
                <th>Infusate</th>
                <th>Experiment</th>
                <th>Feeding Status</th>
                <th>Infusion Rate</th>
                <th>[Infusate]</th>
            </tr>

            {% for pg in pgs.all %}
                {% for study in pg.msrun.sample.animal.studies.all %}
                    <tr>
                        <!-- Compound -->
                        <td>
                            <!-- TODO: add the view link here when it is added for this model -->
                            <a href="{% url 'sample_detail' pg.id %}">
                                {{ pg.name }}
                            </a>
                        </td>

                        <!-- Atom -->
                        <td>
                            {{ pg.msrun.sample.animal.tracer_labeled_atom }}
                        </td>

                        <!-- Sample -->
                        <td>
                            <div class="nobr">
                                <!-- TODO: add the view link here when it is added for this model -->
                                <a href="{% url 'sample_detail' pg.msrun.sample.id %}">
                                    {{ pg.msrun.sample.name }}
                                </a>
                            </div>
                        </td>

                        <!-- Enrichment Fraction -->
                        <td class="text-end">
                            <p title="{{ pg.enrichment_fraction }}">{{ pg.enrichment_fraction|floatformat:4 }}</p>
                        </td>

                        <!-- Tissue -->
                        <td>
                            {{ pg.msrun.sample.tissue.name }}
                        </td>

                        <!-- Mouse -->
                        <td>
                            <!-- TODO: add the view link here when it is added for this model -->
                            <a href="{% url 'animal_detail' pg.msrun.sample.animal.id %}">
                                {{ pg.msrun.sample.animal.name }}
                            </a>
                        </td>

                        <!-- TIC -->
                        <td class="text-end">
                            <p title="{{ pg.total_abundance }}">{{ pg.total_abundance|floatformat:1 }}</p>
                        </td>

                        <!-- NormFraction -->
                        <td class="text-end">
                            <p title="{{ pg.normalized_labeling }}">{{ pg.normalized_labeling|floatformat:4 }}</p>
                        </td>

                        <!-- Infusate -->
                        <td>
                            {{ pg.msrun.sample.animal.tracer_compound.name }}
                        </td>

                        <!-- Experiment -->
                        <td>
                            <a href="{% url 'study_detail' study.id %}">
                                {{ study.name }}
                            </a>
                        </td>

                        <!-- Feeding Status -->
                        <td>
                            {{ pg.msrun.sample.animal.feeding_status }}
                        </td>

                        <!-- Infusion Rate -->
                        <td class="text-end">
                            {{ pg.msrun.sample.animal.tracer_infusion_rate }}
                        </td>

                        <!-- [Infusate] -->
                        <td class="text-end">
                            {{ pg.msrun.sample.animal.tracer_infusion_concentration }}
                        </td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </table>
    {% else %}
        <p>No PeakGroup data found where [{{ qry.mdl }}.{{ qry.fld }}] has a
            match of type [{{ qry.cmp }}] to value [{{ qry.val }}], given the
            table/fields in the {{ qry.fmt }} format.</p>
    {% endif %}
</div>
{% endblock %}
